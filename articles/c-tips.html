<!doctype html>
<html>
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <meta name="description" content="Content of description meta tag"/>
        <meta name="keywords" content="OpenWRT,Mobius,ActionCam,Flytecam,SSD,Linux"/>
        <meta name="author" content="Edgar.Wu"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
        <title>Geek&#39;s Notes - C代码片段
</title>
        <link rel="stylesheet" href="/assets/vendor/normalize.css"/>
        <link rel="stylesheet" href="/assets/vendor/prettify-night.css"/>
        <link rel="stylesheet" href="/assets/themes/default/main.css"/>
        <link rel="shortcut icon" href="/fav.ico"/>
        <script type="text/javascript" src="/assets/vendor/prettify.js"></script>
        
    </head>
    <body onload="prettyPrint()">
    <div id="header">
        <div id="header-inner">
            <div id="title"><a href="/">Geek&#39;s Notes</a></div>
            <div id="subtitle">Open your heart &amp; Enjoy the life course</div>
        </div>
    </div>

<div id="main">
    <div id="main-inner">
        <div id="topnav">
            <ul>
                <li><a href="/">首页</a></li>
                <li class="sep"> | </li>
                <li><a href="/tag.html">标签</a></li>
                
<li class="sep"> | </li>
<li><a href="/pages/about-me.html" target="_self">关于我</a></li>

<li class="sep"> | </li>
<li><a href="https://github.com/edgar1470" target="_blank">github</a></li>

<li class="sep"> | </li>
<li><a href="http://edgar1470.github.io/rss.xml" target="_blank">RSS</a></li>


            </ul>
            <div style="clear:both;"></div>
        </div>
        <div id="article-title">
            <a href="/articles/c-tips.html">C代码片段</a>
        </div>
        <div id="article-meta">
            作者 Edgar1470 | 发布于 2014-01-16 15:42:30 | 最后更新 2016-07-08 22:47:55
        </div>
        <div id="article-tags">
        
        <a class="tag" href="/tag.html#program">program</a>
        
        <a class="tag" href="/tag.html#c">c</a>
        
        </div>
        <div id="article-content">
            <p>C Tips</p>
<!-- toc -->
<ul>
<li><a href="#程序执行时间测试">程序执行时间测试</a></li>
<li><a href="#自动转换代码">自动转换代码</a></li>
</ul>
<!-- toc stop -->
<h3 id="程序执行时间测试">程序执行时间测试</h3>
<p><a href="https://msdn.microsoft.com/en-us/library/4e2ess30.aspx">Calculates the wall-clock time used by the calling process.</a>
The clock function tells how much wall-clock time the calling process has used. Note that this is not strictly conformant with ISO C99, which specifies net CPU time as the return value. To obtain CPU time, use the Win32 GetProcessTimes function.
A timer tick is approximately equal to 1/CLOCKS_PER_SEC seconds. Given enough time, the value returned by clock can exceed the maximum positive value of clock_t and become negative, or exceed the maximum absolute value and roll over. Do not rely on this value for total elapsed time in processes that run for more than 214,748 seconds, or about 59 hours.</p>
<pre class="prettyprint linenums lang-c">// crt_clock.c
// This example prompts for how long
// the program is to run and then continuously
// displays the elapsed time for that period.
//

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;time.h&gt;

void sleep( clock_t wait );

int main( void )
{
   long    i = 6000000L;
   clock_t start, finish;
   double  duration;

   // Delay for a specified time.
   printf( &quot;Delay for three seconds\n&quot; );
   sleep( (clock_t)3 * CLOCKS_PER_SEC );
   printf( &quot;Done!\n&quot; );

   // Measure the duration of an event.
   printf( &quot;Time to do %ld empty loops is &quot;, i );
   start = clock();
   while( i-- ) 
      ;
   finish = clock();
   duration = (double)(finish - start) / CLOCKS_PER_SEC;
   printf( &quot;%2.1f seconds\n&quot;, duration );
}

// Pauses for a specified number of milliseconds.
void sleep( clock_t wait )
{
   clock_t goal;
   goal = wait + clock();
   while( goal &gt; clock() )
      ;
}
</pre>
<h3 id="自动转换代码">自动转换代码</h3>
<p><a href="http://www.parashift.com/c++-faq/convert-to-c.html">Is it possible to convert C++ to C?</a> 答案是：</p>
<ul>
<li>NO. 不能把C++代码自动转换成可读性和可维护性的C代码</li>
<li>YES. 能自动转换,但有很多限制
<a href="http://llvm.org/releases/3.1/docs/FAQ.html#translatecxx">Can I use LLVM to convert C++ code to C code?</a></li>
</ul>
<p>Yes, you can use LLVM to convert code from any language LLVM supports to C. Note that the generated C code will be very low level (all loops are lowered to gotos, etc) and not very pretty (comments are stripped, original source formatting is totally lost, variables are renamed, expressions are regrouped), so this may not be what you&#39;re looking for. Also, there are several limitations noted below.</p>
<p>在google 怎么用llvm 转换C++源代码到C源代码时,发现了这个 <a href="http://llvm.org/releases/3.1/docs/ReleaseNotes.html#changes">http://llvm.org/releases/3.1/docs/ReleaseNotes.html#changes</a> LLVM 从3.1版本就不再支持从其它语言转换成C源代码的功能 但转换成汇编的功能继续可用</p>
<pre class="prettyprint linenums lang-bash">$ clang –c –emit-llvm –o test.bc test.c
$ opt –O1 –o test.bc test.bc
$ llc –o test.s test.bc
$ gcc –o test test.s
</pre>
<p><a href="http://en.wikipedia.org/wiki/Source-to-source_compiler">http://en.wikipedia.org/wiki/Source-to-source_compiler</a></p>

        </div>
        
    </div>
</div>
        <div id="footer">
            <div id="footer-inner">
                <p id="copyright">Copyright &copy; 2014-2016 Edgar.Wu</p>
            </div>
        </div>
        
    </body>
</html>

