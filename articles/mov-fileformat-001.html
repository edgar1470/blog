<!doctype html>
<html>
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <meta name="description" content="Geeks Note for Embedded System"/>
        <meta name="keywords" content="OpenWRT,GoPro,Mobius ActionCam,Flytecam,SSD"/>
        <meta name="author" content="Edgar1470"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
        <title>Geeks Note - .MOV内嵌GPS信息分析之一
</title>
        <link rel="stylesheet" href="/assets/vendor/normalize.css"/>
        <link rel="stylesheet" href="/assets/vendor/prettify-night.css"/>
        <link rel="stylesheet" href="/assets/themes/default/main.css"/>
        <link rel="shortcut icon" href="/fav.ico"/>
        <script type="text/javascript" src="/assets/vendor/prettify.js"></script>
        
    </head>
    <body onload="prettyPrint()">
    <div id="header">
        <div id="header-inner">
            <div id="title"><a href="/">Geeks Note</a></div>
            <div id="subtitle">Open your heart &amp; Enjoy the life course</div>
        </div>
    </div>

<div id="main">
    <div id="main-inner">
        <div id="topnav">
            <ul>
                <li><a href="/">首页</a></li>
                <li class="sep"> | </li>
                <li><a href="/tag.html">标签</a></li>
                
<li class="sep"> | </li>
<li><a href="/pages/about-me.html" target="_self">关于我</a></li>

<li class="sep"> | </li>
<li><a href="https://github.com/edgar1470" target="_blank">Github</a></li>

<li class="sep"> | </li>
<li><a href="http://edgar1470.github.io/rss.xml" target="_blank">RSS</a></li>


            </ul>
            <div style="clear:both;"></div>
        </div>
        <div id="article-title">
            <a href="/articles/mov-fileformat-001.html">.MOV内嵌GPS信息分析之一</a>
        </div>
        <div id="article-meta">
            作者 edgar1470 | 发布于 2014-01-09 14:03:10
        </div>
        <div id="article-tags">
        
        <a class="tag" href="/tag.html#mov">mov</a>
        
        <a class="tag" href="/tag.html#gps">gps</a>
        
        </div>
        <div id="article-content">
            <h3 id="mov-gps-">MOV内嵌GPS信息分析之一</h3>
<ul>
<li><a href="#base-framework">基本框架</a>    </li>
<li><a href="#atom-size">ATOM大小计算</a>    </li>
<li><a href="#atom-structrue">MOV文件基本ATOM</a>                            </li>
<li><a href="#atom-basic">Basic ATOM</a></li>
<li><a href="#atom-ftyp">ATOM ftyp</a></li>
<li><a href="#nt96650">NTK96650录制的MOV文件信息</a> </li>
</ul>
<p>官方资料 [QuickTime File Format Specification](<a href="https://developer.apple.com/library/mac/documentation/quicktime/qtff/QTFFChap1/qtff1">https://developer.apple.com/library/mac/documentation/quicktime/qtff/QTFFChap1/qtff1</a></p>
<h3 id="-a-name-base-framework-a-"><a name="base-framework"> 基本框架 </a></h3>
<p> <img src="../images/qtff_atom_sample.gif" alt="qtff-atom">                                   </p>
<h3 id="-a-name-atom-size-atom-a-"><a name="atom-size"> ATOM大小计算 </a></h3>
<p> <img src="../images/qtff_atom_size.gif" alt="qtff-size">                                     </p>
<h3 id="-a-name-atom-structrue-mov-atom-a-"><a name="atom-structrue"> MOV文件基本ATOM </a></h3>
<p> <img src="../images/qtff_mov_structure.gif" alt="qtff-structrue">                            </p>
<h3 id="-a-name-atom-basic-basic-atom-a-"><a name="atom-basic"> Basic ATOM </a></h3>
<p>Basic atom types of a QuickTime file<br>|  Atom type   |  Use |<br>|--------------|:------|
|  <strong>&#39;ftyp&#39;</strong>  |File type compatibility—identifies the file type and differentiates it from similar file types, such as MPEG-4 files and JPEG-2000 files.|
|  <strong>&#39;moov&#39;</strong>  |Movie resource metadata about the movie (number and type of tracks, location of sample data, and so on). Describes where the movie data can be found and how to interpret it.|
|  <strong>&#39;mdat&#39;</strong>  |Movie sample data—media samples such as video frames and groups of audio samples. Usually this data can be interpreted only by using the movie resource.|
|  <strong>&#39;free&#39;</strong>  |Unused space available in file. |
|  <strong>&#39;skip&#39;</strong>  |Unused space available in file.|<br>|  <strong>&#39;wide&#39;</strong>  |Reserved space—can be overwritten by an extended size field if the following atom exceeds 2^32 bytes, without displacing the contents of the following atom.|
|  <strong>&#39;pnot&#39;</strong>  |Reference to movie preview data.|                                        </p>
<h3 id="-a-name-atom-ftyp-atom-ftyp-a-"><a name="atom-ftyp"> ATOM ftyp</a></h3>
<p><em>&#39;ftyp&#39;</em>  The File Type Compatibility Atom<br>  The file type atom is optional, but strongly recommended. If present, it must be the first significant atom in the file, preceding the movie atom (and any free space atoms, preview atom, or movie data atoms).</p>
<pre class="prettyprint linenums lang-shell">edgar@debian:/data_disk/github/edgar1470.github.io/articles/qtff$ xxd -g4 -l 100 REC_0001_GPS_FAKE.MOV 
0000000: 00000018 66747970 71742020 00000000  ....ftypqt  ....
0000010: 71742020 00000000 0000747c 66726561  qt  ......t|frea
0000020: 0000000c 74696d61 00000009 00001be4  ....tima........
0000030: 74686d61 ffd8ffdb 00840006 04050605  thma............
0000040: 04060605 06070706 080a100a 0a09090a  ................
0000050: 140e0f0c 10171418 18171416 161a1d25  ...............%
0000060: 1f1a1b23                             ...#
</pre>
<p>the file type atom has an atom type value of &#39;ftyp&#39; and contains the following fields:</p>
<ul>
<li>Size<br>A 32-bit unsigned integer that specifies the number of bytes in this atom.<pre class="prettyprint linenums lang-shell">edgar@debian:/data_disk/github/edgar1470.github.io/articles/qtff$ xxd -g4 -l 100 REC_0001_GPS_FAKE.MOV 
0000000: 00000018 66747970 71742020 00000000  ....ftypqt  ....
              |
       size = 0x18
</pre>
</li>
<li>Type<br>A 32-bit unsigned integer that identifies the atom type, typically represented as a four-character code; this field must be set to &#39;ftyp&#39;.<pre class="prettyprint linenums lang-shell">edgar@debian:/data_disk/github/edgar1470.github.io/articles/qtff$ xxd -g4 -l 100 REC_0001_GPS_FAKE.MOV 
0000000: 00000018 66747970 71742020 00000000  ....ftypqt  ....
                       |
                must be &#39;ftyp&#39;
</pre>
</li>
<li>Major_Brand<br>A 32-bit unsigned integer that should be set to &#39;qt  &#39; (note the two trailing ASCII space characters) for QuickTime movie files. If a file is compatible with multiple brands, all such brands are listed in the Compatible_Brands fields, and the Major_Brand identifies the preferred brand or best use.<pre class="prettyprint linenums lang-shell">edgar@debian:/data_disk/github/edgar1470.github.io/articles/qtff$ xxd -g4 -l 100 REC_0001_GPS_FAKE.MOV 
0000000: 00000018 66747970 71742020 00000000  ....ftypqt  ....
                                |
                              must be &#39;qt  &#39;
</pre>
</li>
<li>Minor_Version<br>A 32-bit field that indicates the file format specification version. For QuickTime movie files, this takes the form of four binary-coded decimal values, indicating the century, year, and month of the QuickTime File Format Specification, followed by a binary coded decimal zero. For example, for the June 2004 minor version, this field is set to the BCD values 20 04 06 00.<pre class="prettyprint linenums lang-shell">edgar@debian:/data_disk/github/edgar1470.github.io/articles/qtff$ xxd -g4 -l 100 REC_0001_GPS_FAKE.MOV 
0000000: 00000018 66747970 71742020 00000000  ....ftypqt  ....
                                         |
                               minor version
</pre>
</li>
<li>Compatible_Brands[ ]<br>A series of unsigned 32-bit integers listing compatible file formats. The major brand must appear in the list of compatible brands. One or more “placeholder” entries with value zero are permitted; such entries should be ignored.
If none of the Compatible_Brands fields is set to &#39;qt  &#39;, then the file is not a QuickTime movie file and is not compatible with this specification. Applications should return an error and close the file, or else invoke a file importer appropriate to one of the specified brands, preferably the major brand. QuickTime currently returns an error when attempting to open a file whose file type, file extension, or MIME type identifies it as a QuickTime movie, but whose file type atom does not include the &#39;qt  &#39; brand.<pre class="prettyprint linenums lang-shell">edgar@debian:/data_disk/github/edgar1470.github.io/articles/qtff$ xxd -g4 -l 100 REC_0001_GPS_FAKE.MOV 
0000000: 00000018 66747970 71742020 00000000  ....ftypqt  ....
0000010: 71742020 00000000 0000747c 66726561  qt  ......t|frea
              |
        compatiable_brands
</pre>
Note: A common source of this error is an MPEG-4 file incorrectly named with the .mov file extension or with the MIME type incorrectly set to “video/quicktime”. MPEG-4 files are automatically imported by QuickTime only when they are correctly identified as MPEG-4 files using the Mac OS file type, file extension, or MIME type.
If you are creating a file type that is fully compatible with the QuickTime file format, one of the Compatible_Brand fields must be set to &#39;qt  &#39;; otherwise QuickTime will not recognize the file as a QuickTime movie.</li>
</ul>
<p>Warning:  Use of the QuickTime file format in this manner is subject to license from Apple, Inc.</p>
<h3 id="-a-name-nt96650-ntk96650-mov-a-"><a name="nt96650">NTK96650录制的MOV文件信息</a></h3>
<p>以文件<strong>REC_0001_GPS_FAKE.MOV</strong>为例:
   文件大小(字节) : 17894846  = 0x1110DBE<br>   第一层atom  </p>
<ul>
<li>ftyp  长度 = 0x00000018</li>
<li>frea  长度 = 0x0000747c</li>
<li>mdat  长度 = 0x01108b74 </li>
<li>moov  长度 = 0x00000db6 </li>
</ul>
<pre class="prettyprint linenums lang-shell">edgar@debian:/data_disk/github/edgar1470.github.io/articles/qtff$ xxd -g4 -l 100 REC_0001_GPS_FAKE.MOV 
0000000: 00000018 66747970 71742020 00000000  ....ftypqt  ....
0000010: 71742020 00000000 0000747c 66726561  qt  ......t|frea
0000020: 0000000c 74696d61 00000009 00001be4  ....tima........
0000030: 74686d61 ffd8ffdb 00840006 04050605  thma............
0000040: 04060605 06070706 080a100a 0a09090a  ................
0000050: 140e0f0c 10171418 18171416 161a1d25  ...............%
0000060: 1f1a1b23                             ...#

edgar@debian:/data_disk/github/edgar1470.github.io/articles/qtff$ xxd -g4 -s 0x18 -l 100 REC_0001_GPS_FAKE.MOV 
0000018: 0000747c 66726561 0000000c 74696d61  ..t|frea....tima
0000028: 00000009 00001be4 74686d61 ffd8ffdb  ........thma....
0000038: 00840006 04050605 04060605 06070706  ................
0000048: 080a100a 0a09090a 140e0f0c 10171418  ................
0000058: 18171416 161a1d25 1f1a1b23 1c161620  .......%...#... 
0000068: 2c202326 27292a29 191f2d30 2d283025  , #&amp;&#39;)*)..-0-(0%
0000078: 28292801                             ()(.

edgar@debian:/data_disk/github/edgar1470.github.io/articles/qtff$ xxd -g4 -s 0x7494 -l 100 REC_0001_GPS_FAKE.MOV 
0007494: 01108b74 6d646174 00000000 00000000  ...tmdat........
00074a4: 00000000 00000000 00000000 00000000  ................
00074b4: 00000000 00000000 00000000 00000000  ................
00074c4: 00000000 00000000 00000000 00000000  ................
00074d4: 00000000 00000000 00000000 00000000  ................
00074e4: 00000000 00000000 00000000 00000000  ................
00074f4: 00000000                             ....

edgar@debian:/data_disk/github/edgar1470.github.io/articles/qtff$ xxd -g4 -s 0x1110008 -l 100 REC_0001_GPS_FAKE.MOV 
1110008: 00000db6 6d6f6f76 0000006c 6d766864  ....moov...lmvhd
1110018: 00000000 cd07d7d4 cd07d7d4 00007530  ..............u0
1110028: 00041eb0 00010000 01000000 00000000  ................
1110038: 00000000 00010000 00000000 00000000  ................
1110048: 00000000 00010000 00000000 00000000  ................
1110058: 00000000 40000000 00000000 00000000  ....@...........
1110068: 00000000                             ....

edgar@debian:/data_disk/github/edgar1470.github.io/articles/qtff$ xxd -g4 -s 0x1110D80 -l 100 REC_0001_GPS_FAKE.MOV 
1110d80: d4800000 f2000001 0f800000 00003375  ..............3u
1110d90: 64746100 000013a9 666d7400 07000044  dta.....fmt....D
1110da0: 56522d43 44000000 0018a969 6e66000c  VR-CD......inf..
1110db0: 00004844 4456522d 31303830 5000      ..HDDVR-1080P.
</pre>

        </div>
        
    </div>
</div>
        <div id="footer">
            <div id="footer-inner">
                <p id="copyright">
                Powered By <a href="https://github.com/ericzhang-cn/papery">papery</a>   Copyright &copy; 2014-2014 Edgar1470
                </p>
            </div>
        </div>
        <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

    </body>
</html>

